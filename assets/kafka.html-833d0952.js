import{_ as a,p as s,q as e,a1 as n}from"./framework-5866ffd3.js";const l={},i=n(`<h3 id="kafka常用命令梳理" tabindex="-1"><a class="header-anchor" href="#kafka常用命令梳理" aria-hidden="true">#</a> kafka常用命令梳理</h3><blockquote><p>参考链接（http://orchome.com/454）</p></blockquote><ul><li>启动kafka server</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">nohup</span> /usr/local/kafka/bin/kafka-server-start.sh /usr/local/kafka/config/server.properties <span class="token operator">&gt;</span> kafka.log <span class="token operator">&amp;</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>创建topic</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--topic</span> testhq2 <span class="token parameter variable">--zookeeper</span> localhost:2181 <span class="token parameter variable">--partitions</span> <span class="token number">3</span> --replication-factor <span class="token number">1</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>启动producer</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-console-producer.sh --broker-list realtime:9092  <span class="token parameter variable">--topic</span> pay_statisv2                      
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>在线增加分区数量</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2181 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> mytopic <span class="token parameter variable">--partitions</span> <span class="token number">16</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>启动consumer(查看历史数据)</li></ul><div class="language-shelk line-numbers-mode" data-ext="shelk"><pre class="language-shelk"><code>     bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic mytopic --from-beginning    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>启动consumer(查看实时数据)</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-console-consumer.sh <span class="token parameter variable">--zookeeper</span> localhost:2181 <span class="token parameter variable">--topic</span> mytopic
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>启动consumer 新的命令</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>      bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--topic</span> mytopic
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>列出包含不同步副本的分区</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2181 <span class="token parameter variable">--describe</span> --under-replicated-partitions 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>列出没有首领的分区</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2181 <span class="token parameter variable">--describe</span> --unavailable-partitions
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>列出来所有的topic</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>      bin/kafka-topics.sh <span class="token parameter variable">--list</span> <span class="token parameter variable">--zookeeper</span> localhost:2181        
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>列出消费者组</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-consumer-groups.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">52.80</span>.152.202:2182 <span class="token parameter variable">--list</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>通过offset查看消费情况</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-run-class.sh kafka.tools.ConsumerOffsetChecker <span class="token parameter variable">--zookeeper</span> localhost:2181 <span class="token parameter variable">--topic</span> mytopic <span class="token parameter variable">--group</span> etl-id     
以下为结果：logSize为总的kafka数据，offset为已经消费的，Lag是未消费的 <span class="token assign-left variable">Lag</span><span class="token operator">=</span>logSize-offset
Group    Topic    Pid    offset    logSize    Lag    Owner
etl-id    statisv2    <span class="token number">0</span>    <span class="token number">139380158</span>    <span class="token number">139380158</span>    <span class="token number">0</span>    none
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>列出此topic基本信息</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-topics.sh <span class="token parameter variable">--describe</span> <span class="token parameter variable">-zookeeper</span> localhost:2181 <span class="token parameter variable">--topic</span> mytopic
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>删除topic</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2182 <span class="token parameter variable">--delete</span> <span class="token parameter variable">--topic</span> mytopic<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>修改分区个数为23</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-topics.sh <span class="token parameter variable">--alter</span> <span class="token parameter variable">--zookeeper</span> <span class="token number">172.16</span>.120.170:2182,172.16.120.171:2182,172.16.120.172:2182 <span class="token parameter variable">--topic</span> pay_zg_total_random <span class="token parameter variable">--partitions</span> <span class="token number">23</span> 
bin/kafka-run-class.sh kafka.tools.UpdateOffsetsInZK latest gate-consumer.properties mytopic<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>kafka 数据导入导出：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-console-consumer.sh <span class="token parameter variable">--zookeeper</span> localhost:2181 <span class="token parameter variable">--topic</span> mytopic <span class="token operator">|</span> <span class="token function">grep</span> <span class="token punctuation">\\</span>&quot;js <span class="token operator">&gt;</span> yuge.jsk
bin/kafka-console-producer.sh --broker-list realtime-1:9092  <span class="token parameter variable">--topic</span> mytopic <span class="token operator">&lt;</span> /home/centos/yuge.jsk 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>kafka 2.x.x 版本导入导出</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@realtime-1 kafka<span class="token punctuation">]</span><span class="token comment"># /data/localization/kafka/bin/kafka-console-producer.sh --broker-list localhost:9092 --topic mytopic  &lt; /tmp/aaa</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>kafka topic数据保存时间，在线调整</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2182 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> mytopic <span class="token parameter variable">--config</span> <span class="token assign-left variable">retention.ms</span><span class="token operator">=</span><span class="token number">3600000</span> （一小时）
bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2182 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> mytopic <span class="token parameter variable">--config</span> <span class="token assign-left variable">retention.ms</span><span class="token operator">=</span><span class="token number">86400000</span>  （24小时，1天）

bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2182 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> mytopic <span class="token parameter variable">--config</span> <span class="token assign-left variable">retention.ms</span><span class="token operator">=</span><span class="token number">172800000</span>  （48小时，2天）

bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2182 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> mytopic <span class="token parameter variable">--config</span> <span class="token assign-left variable">retention.ms</span><span class="token operator">=</span><span class="token number">432000000</span> （120小时，5天）

bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2182 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> mytopic <span class="token parameter variable">--config</span> <span class="token assign-left variable">retention.ms</span><span class="token operator">=</span><span class="token number">604800000</span>（168小时，7天）

bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2182 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> mytopic <span class="token parameter variable">--config</span> <span class="token assign-left variable">retention.ms</span><span class="token operator">=</span><span class="token number">1296000000</span> （15天）

bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2182 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> mytopic <span class="token parameter variable">--config</span> <span class="token assign-left variable">retention.ms</span><span class="token operator">=</span><span class="token number">2592000000</span> <span class="token punctuation">(</span>一个月<span class="token punctuation">)</span>

bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2182 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> sdklua_online <span class="token parameter variable">--config</span> <span class="token assign-left variable">retention.ms</span><span class="token operator">=</span><span class="token number">259200000</span> <span class="token punctuation">(</span><span class="token number">3</span>天<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查询topic信息：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>./bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2182 <span class="token parameter variable">--describe</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>调整kafka offset值</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>get /consumers/etl-gate/offsets/sdklua_online/0  

<span class="token builtin class-name">set</span> /consumers/etl-gate/offsets/sdklua_online/0  <span class="token number">3756359731</span>
<span class="token builtin class-name">set</span> /consumers/etl-gate/offsets/sdklua_online/1  <span class="token number">3753582283</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://note.youdao.com/yws/res/15567/WEBRESOURCEff86b930ec461a4eaaf1cb5ad2f823c9" alt="哈雷.jpg"></p>`,43),r=[i];function t(p,o){return s(),e("div",null,r)}const d=a(l,[["render",t],["__file","kafka.html.vue"]]);export{d as default};
